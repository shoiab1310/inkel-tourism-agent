{% extends "layout.html" %}

{% block content %}
<div class="container my-4">
    <h3 class="text-center mb-4">Welcome, {{ username }}! Plan your trip üöÄ</h3>
    
    <!-- Sample queries helper -->
    <div class="alert alert-info mb-3" role="alert">
        <strong>üí° Try asking:</strong> "What's the temperature in Bangalore?", "Suggest top 5 places in Delhi", "Weather and places to visit in Goa"
    </div>
    
    <div id="chat-window" class="bg-light rounded shadow p-3" style="max-height: 500px; overflow-y: auto;">
        {% if messages %}
            {% for msg in messages %}
                <div class="mb-3">
                    {% if msg.sender == 'user' %}
                        <div class="text-end">
                            <span class="badge bg-primary mb-1">{{ username }}</span>
                            <div class="chat-bubble bg-primary text-white">{{ msg.text | safe }}</div>
                        </div>
                    {% else %}
                        <div class="text-start">
                            <span class="badge bg-success mb-1">Tourism AI</span>
                            <div class="chat-bubble bg-success text-white" style="white-space: pre-line;">{{ msg.text | safe }}</div>
                        </div>
                    {% endif %}
                </div>
            {% endfor %}
        {% else %}
            <div class="text-center text-muted py-5">
                <h5>üëã Start planning your trip!</h5>
                <p>Ask me about weather, places to visit, or tourist attractions in any city.</p>
            </div>
        {% endif %}
    </div>
    
    <form method="POST" class="mt-3" autocomplete="off" id="chatForm">
        <div class="input-group">
            <input type="text" 
                   name="chat_input" 
                   id="chatInput"
                   class="form-control" 
                   placeholder="Ask about weather or places to visit..." 
                   required>
            <button class="btn btn-success" type="submit">
                <span id="sendIcon">Send üì§</span>
            </button>
            
        </div>
    </form>
    <form action="{{ url_for('clear_chat') }}" method="POST" class="mb-3">
    <button type="submit" class="btn btn-danger">Clear Chat</button>
    </form>
</div>

<style>
    .chat-bubble {
        border-radius: 1em;
        padding: 0.75em 1em;
        display: inline-block;
        margin-bottom: 0.5em;
        max-width: 90%;
        word-break: break-word;
        box-shadow: 0 2px 4px rgba(0,0,0,0.1);
    }
    
    #chat-window {
        scroll-behavior: smooth;
    }
    
    .input-group input:focus {
        border-color: #28a745;
        box-shadow: 0 0 0 0.2rem rgba(40, 167, 69, 0.25);
    }
    
    .alert-info {
        background-color: #e7f3ff;
        border-color: #b3d9ff;
        color: #004085;
    }
</style>

<script>
    // Auto-scroll to bottom of chat window
    document.addEventListener('DOMContentLoaded', function() {
        const chatWindow = document.getElementById('chat-window');
        if (chatWindow) {
            chatWindow.scrollTop = chatWindow.scrollHeight;
        }
        
        // Focus on input field
        const chatInput = document.getElementById('chatInput');
        if (chatInput) {
            chatInput.focus();
        }
    });
    
    // Show loading state on submit
    document.getElementById('chatForm').addEventListener('submit', function() {
        const sendIcon = document.getElementById('sendIcon');
        sendIcon.innerHTML = 'Sending... ‚è≥';
    });
</script>
{% endblock %}